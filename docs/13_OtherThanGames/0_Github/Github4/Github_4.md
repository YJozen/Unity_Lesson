# いろいろ取り消したい
操作を間違えることってよくあります

+ ファイルを間違って編集してしまった
+ コミットメッセージでタイプミスしてしまった
+ 間違えてコミットしてしまった

間違えた作業を「元に戻したい」という状況はよく出てきます  
今回はそういう「取り消し作業」に焦点を当てます

<br>

# リポジトリの準備

Forkを開き、フェッチ＆チェックアウトをして、mainブランチを最新にしてください。  
mainをダブルクリック(または、右クリック)でチェックアウトできます

<img src="images/1.png" width="50%" alt="" title="">

<br>


## Checkout Branch: Don’t change
作業ディレクトリを開き、<u>新しいファイルを追加</u>してください。  
コミットはしないようにお願いします。

Local Changes に (1) がついていれば下準備OKです。

<img src="images/2.png" width="50%" alt="" title="">

<br>



<br>

この状態で、別のブランチをチェックアウトしようとしてください。  
すると、以下のようなダイアログが表示されます。

<img src="images/3.png" width="70%" alt="" title="">

<br>

Don’t change を選んでチェックアウトすると、  

作業ディレクトリに追加したファイルは維持されたまま、他のブランチがチェックアウトできます。  
(ただし、これはいつも必ず成功するとは限りません。)

チェックアウトするブランチと、編集内容が競合した場合、以下のエラーが表示されます。

Local Changesがない状態でチェックアウトするようにしましょう！

<img src="images/4.png" width="70%" alt="" title="">

<br>




## Checkout Branch: Discard

<img src="images/5.png" width="70%" alt="" title="">

<br>
Discardを選ぶとどうなるのでしょうか？

<u>Local Changesにある変更をすべて削除してから</u>チェックアウトすることになります。

取り返しのつかない ことになる可能性があるので、何が起こるか理解した上で使いましょう！
（効果をわかって使うのはOKです）

Discardというのは、破棄するという意味の英単語です。

手札（card）を離す（dis）が語源です。

<br>

## Checkout Branch: Stash and reapply

Stash(隠す)は、作業ディレクトリにある「ファイル変更」を別の場所に退避し、Local Changesがない状態にする機能です。

Apply(適用する)は、別の場所に退避したファイル変更を、作業ディレクトリに反映して、Local Changesがある状態にする機能です。

# Discard changes
作業ディレクトリにファイルを追加して、 Local Changes がある状態にしてください。  
Unstaged にファイルがあればOKです。

<br>

<br>

<img src="images/6.png" width="70%" alt="" title="">

<br>

Unstaged のファイルを 右クリック > Discard changes をクリックすると、ファイル変更を削除できます。  
つまり、ファイルを変更する前の状態に戻せます。

「とあるアイデアを試してみたけど、やっぱりやめた」という場面などで、 Local Changes がない状態へしたいときに便利です！

ただしこれは、<u>取り返しがつかない作業</u> なので、何が起こるか理解した上で使うようにしましょう！
(Forkの場合、 Unstaged のファイルを選択した状態で、キーボードのDeleteキーを押すと、Discard changesが実行できます)


# プル
プル = フェッチ + チェックアウト

<img src="images/7.png" width="50%" alt="" title="">

<br>

プルは、フェッチとチェックアウトを連続して実施します。  
Local Changesがある状態でプルを実行すると、チェックアウトと同じエラーが発生します。  
リモートリポジトリの情報を取得したいだけなら、フェッチの方が安全 です。

# リセット
コミットを削除したいときに使えるのが、リセットです！

Forkには、3種類のリセットがあります！

非常によく使う機能ですが、選択を間違えると、取り返しのつかないことになります ので、十分に理解してから使いましょう！

<img src="images/8.png" width="70%" alt="" title="">

<br>

## Soft Reset / Mixed Reset
作業ディレクトリの状態は維持しつつ、コミットだけ削除したいときに使います。

Mixed は、コミットされてたファイル変更が Unstaged に移動します。
Soft は、コミットされてたファイル変更が Staged に移動します。  
(あまり違いはないので、とくにこだわりがなければ、デフォルトの Mixed を使えば良いです。)

## Hard Reset
コミットを削除して、作業ディレクトリを以前の状態へ戻したいときに使います。

非常に危険で<u>取り返しがつかない操作</u>なので、機能を十分に理解してから使いましょう！

# リワード
コミットメッセージをタイプミスしてしまうこともよくあります。

<img src="images/9.png" width="50%" alt="" title="">

<br>

## コミットメッセージを変更する

今回はあえてタイプミスをしてコミットしたものをプッシュします。

修正したいコミットを右クリックして、 Interactive Rebase > Reword をクリックします。

<img src="images/10.png" width="70%" alt="" title="">

<br>

コミットメッセージを修正して、OK > Rebase で修正できます。

<img src="images/11.png" width="90%" alt="" title="">

<br>

これでコミットメッセージを修正できました！

しかし、ローカルリポジトリのブランチしか修正されていません。

<img src="images/12.png" width="50%" alt="" title="">

<br>

### 強制プッシュ
こういうときは、強制プッシュをします。

<img src="images/13.png" width="70%" alt="" title="">

<br>

プッシュする際に、 Force push にチェックを入れてから、プッシュしてください。  
変更後のコミットで上書きされました。

<img src="images/14.png" width="50%" alt="" title="">

<br>

## 強制プッシュのリスク
強制プッシュを利用すると、ローカルブランチの内容で、リモートブランチの内容を強制的に上書きします。

使い方を間違えると、取り返しのつかないことになりますので、何が起こるか理解した上で使いましょう！


