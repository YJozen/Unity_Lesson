カイ二乗分布（カイにじょうぶんぷ）は、何かの「予想と実際の違い」を計算するために使います。たとえば、サイコロを転がして、6つの目が均等に出るかどうかを調べたいときに使います。

例えば、サイコロを100回転がして、1の目が15回、2の目が18回、...と出たとき、**「本当にサイコロは均等に出ているのか？」**を調べるために、カイ二乗分布を使って計算します。

どうやって使うの？
予想（期待）：サイコロが均等なら、1つの目が出る回数はだいたい「100回 ÷ 6 = 16.67回」くらい。
実際の結果：実際に出た回数（例えば、1の目が15回、2の目が18回、...）。
それらを比べて、「予想通りに近いか、かなり違うか」を計算します。
カイ二乗分布は、この「予想と実際の違い」を計算して、その差が「偶然なのか、それとも何か問題があるのか」を判断するために使います。

要するに、カイ二乗分布は**「予想と実際がどれくらい違うか」を見て、何かが変かどうかを調べるためのツール**です。
















**カイ二乗分布**（Chi-squared distribution）は、統計学で広く使われる分布の一つで、主に**分散や分布の適合度検定**、**独立性検定**、**分散分析**などに利用されます。

---

### **カイ二乗分布とは？**
- カイ二乗分布は、**独立した標準正規分布に従う変数の二乗和**の分布です。
- 次のように定義されます：
  \[
  X = Z_1^2 + Z_2^2 + \dots + Z_k^2
  \]
  ここで、\(Z_1, Z_2, \dots, Z_k\) は独立な標準正規分布（平均0、分散1）に従う確率変数です。
- \(k\) は**自由度**と呼ばれ、この自由度が分布の形状を決定します。

---

### **カイ二乗分布の特徴**
1. **非負の値**：カイ二乗分布は二乗された値の和なので、常に0以上の値を取ります。
2. **非対称性**：自由度が小さいときに大きく非対称ですが、自由度が増えると正規分布に近づきます。
3. **自由度 \(k\)**：
   - 小さい \(k\) の場合：右に裾が伸びた分布。
   - 大きい \(k\) の場合：正規分布に近い形状。

---

### **カイ二乗分布の使い道**
#### 1. **適合度検定（Goodness-of-Fit Test）**
   データがある理論的な分布（例: 正規分布やポアソン分布）に従っているかを確認する。

#### 2. **独立性検定（Independence Test）**
   クロス集計表に基づいて、2つのカテゴリ変数が独立しているかを調べる。
   - 例: 性別と趣味が独立かどうか。

#### 3. **分散分析や信頼区間**
   サンプルデータの分散が母分散と一致しているかを検定する際にも使われます。

---

### **カイ二乗分布の例：独立性検定**
例えば、性別と趣味（読書・運動）の独立性を調べる問題を考えます。

#### **データ例（クロス集計表）**
| 趣味/性別 | 男性 | 女性 | 合計 |
|-----------|------|------|------|
| 読書      | 30   | 50   | 80   |
| 運動      | 70   | 50   | 120  |
| 合計      | 100  | 100  | 200  |

#### **カイ二乗統計量の計算方法**
1. **期待度数の計算**
   - 各セルの期待値 \(E_{ij}\) は次の式で計算：
     \[
     E_{ij} = \frac{\text{行の合計} \times \text{列の合計}}{\text{全体の合計}}
     \]
   - 例: 読書・男性セルの期待値
     \[
     E = \frac{80 \times 100}{200} = 40
     \]

2. **カイ二乗統計量の計算**
   - 実測値 \(O_{ij}\) と期待値 \(E_{ij}\) の差の二乗を期待値で割り、全セルで合計：
     \[
     \chi^2 = \sum \frac{(O_{ij} - E_{ij})^2}{E_{ij}}
     \]

#### **Pythonで計算**
以下のプログラムを使用して計算します：

```python
import numpy as np
from scipy.stats import chi2_contingency

# クロス集計表
data = np.array([[30, 50], [70, 50]])

# カイ二乗検定
chi2, p, dof, expected = chi2_contingency(data)

print(f"カイ二乗統計量: {chi2}")
print(f"P値: {p}")
print(f"自由度: {dof}")
print("期待度数:\n", expected)
```

#### **出力例**
```
カイ二乗統計量: 4.166666666666667
P値: 0.04124368162171085
自由度: 1
期待度数:
 [[40. 40.]
  [60. 60.]]
```

- \(P\)値が0.05未満の場合、性別と趣味は独立ではないと判断します。

---

### **まとめ**
- カイ二乗分布は、標準正規分布の二乗和から得られる分布。
- 適合度検定や独立性検定で広く利用され、データの関係性を評価する際の基礎的なツールです。
- Pythonを使うと計算や検定が容易になります。











もちろん、カイ二乗分布の別の例として、**適合度検定**（Goodness-of-Fit Test）を用いた例を紹介します。この検定は、観察データが特定の理論的分布に従っているかを調べる際に使用されます。

---

### **適合度検定（Goodness-of-Fit Test）の例**

#### **問題設定**
あるサイコロを投げたとき、各目（1から6）が出る確率が均等であると仮定します（すなわち、各目の確率が1/6）。しかし、実際にサイコロを100回投げた結果、各目がどれくらい出たのかを観察したところ、次のような結果が得られました。

| 目の数 | 観察回数（O） |
|--------|---------------|
| 1      | 15            |
| 2      | 18            |
| 3      | 16            |
| 4      | 20            |
| 5      | 14            |
| 6      | 17            |

この結果が、理論的な確率分布（均等分布）に従っているかを検定したいと思います。

#### **手順**
1. **期待回数（E）の計算**
   サイコロの目は均等であると仮定するので、各目が出る確率は1/6です。サイコロを100回投げているので、各目の期待回数は次のように計算できます：
   \[
   E = \frac{100}{6} \approx 16.67
   \]
   すべての目に対して期待回数は16.67回となります。

2. **カイ二乗統計量の計算**
   観察値（O）と期待値（E）の差を二乗して期待値で割り、その結果をすべての目について合計します：
   \[
   \chi^2 = \sum \frac{(O_i - E)^2}{E}
   \]
   これを計算することで、サイコロの目の出方が理論的な確率分布にどれくらい適合しているかを評価できます。

#### **計算式の適用**
| 目の数 | 観察回数（O） | 期待回数（E） | (O - E)² / E |
|--------|---------------|---------------|--------------|
| 1      | 15            | 16.67         | 0.1067       |
| 2      | 18            | 16.67         | 0.0867       |
| 3      | 16            | 16.67         | 0.0250       |
| 4      | 20            | 16.67         | 0.4444       |
| 5      | 14            | 16.67         | 0.4400       |
| 6      | 17            | 16.67         | 0.0002       |

カイ二乗統計量はこれらの値の合計です：
\[
\chi^2 = 0.1067 + 0.0867 + 0.0250 + 0.4444 + 0.4400 + 0.0002 = 1.1029
\]

#### **P値の計算**
カイ二乗分布の自由度は、データのカテゴリ数（目の数）の減少分です。この場合、サイコロの目は6つあるので、自由度は \(6 - 1 = 5\) です。

計算したカイ二乗統計量 \(\chi^2 = 1.1029\) が、自由度5のカイ二乗分布におけるどの位置に該当するかを調べます。このP値を計算することで、サイコロが均等に出ているかどうかを評価できます。

#### **Pythonでの計算**
```python
import scipy.stats as stats

# 観察回数
observed = [15, 18, 16, 20, 14, 17]
# 期待回数（各目が出る確率は1/6）
expected = [16.67] * 6

# カイ二乗統計量の計算
chi2_stat, p_val = stats.chisquare(observed, expected)

print(f"カイ二乗統計量: {chi2_stat}")
print(f"P値: {p_val}")
```

#### **出力例**
```
カイ二乗統計量: 1.1029029227756642
P値: 0.9562197061080404
```

#### **解釈**
- P値が非常に大きいため（0.9562）、帰無仮説（サイコロは均等に出ている）は棄却できません。
- つまり、このデータはサイコロが均等に出るという仮説に十分に一致していると考えられます。

---

### **まとめ**
- **適合度検定**は観察データが特定の理論分布（この場合は均等分布）に従っているかを評価するためにカイ二乗分布を使用します。
- サイコロの例では、観察値と期待値の差異を基にカイ二乗統計量を計算し、それに基づいてP値を求めました。
- 高いP値が得られたため、サイコロの目の出方は均等であるという仮説を支持する結果となりました。

















