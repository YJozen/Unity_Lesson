重回帰分析を用いて、アイスクリームの売上に気温や湿度以外の説明変数を追加し、モデルを構築する方法について解説します。

---

### **1. 重回帰分析とは**
重回帰分析は、**1つの目的変数**を複数の説明変数で予測するための統計手法です。  
例えば、アイスクリームの売上（目的変数）に以下のような説明変数を考えられます：

- **気温**：アイスの売上に大きく影響する。
- **湿度**：湿度が高いと冷たいものが好まれる傾向がある。
- **曜日**：週末や休日に売上が上がる可能性がある。
- **降水量**：雨の日は外出が減り、売上が減少する。
- **広告費**：広告を打ち出すことで売上が上がる可能性がある。

---

### **2. データ例**
以下のデータを用いるとします：

| 気温 (℃) | 湿度 (%) | 曜日（0=平日, 1=週末） | 降水量 (mm) | 広告費 (千円) | 売上 (個) |
|----------|----------|------------------------|-------------|---------------|----------|
| 25       | 50       | 0                      | 0           | 10            | 100      |
| 30       | 40       | 1                      | 0           | 15            | 200      |
| 28       | 60       | 0                      | 5           | 8             | 150      |
| 32       | 35       | 1                      | 0           | 20            | 250      |
| 27       | 55       | 0                      | 10          | 5             | 120      |

---

### **3. 重回帰モデルの式**
重回帰分析では、目的変数 \( y \) を以下のように表します：

\[
y = a_1 x_1 + a_2 x_2 + a_3 x_3 + a_4 x_4 + a_5 x_5 + b
\]

- \( y \)：売上
- \( x_1, x_2, x_3, x_4, x_5 \)：説明変数（気温、湿度、曜日、降水量、広告費）
- \( a_1, a_2, \ldots, a_5 \)：各説明変数の重み（回帰係数）
- \( b \)：切片（全説明変数がゼロのときの売上）

---

### **4. Pythonでの分析**
重回帰分析をPythonで行う場合、以下のコードが例です：

```python
import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression

# データ準備
data = {
    '気温': [25, 30, 28, 32, 27],
    '湿度': [50, 40, 60, 35, 55],
    '曜日': [0, 1, 0, 1, 0],
    '降水量': [0, 0, 5, 0, 10],
    '広告費': [10, 15, 8, 20, 5],
    '売上': [100, 200, 150, 250, 120]
}

df = pd.DataFrame(data)

# 説明変数と目的変数
X = df[['気温', '湿度', '曜日', '降水量', '広告費']]
y = df['売上']

# モデル作成
model = LinearRegression()
model.fit(X, y)

# 回帰係数と切片
coefficients = model.coef_
intercept = model.intercept_

print("回帰係数:", coefficients)
print("切片:", intercept)

# 売上予測
new_data = [[29, 50, 1, 0, 10]]  # 気温29℃, 湿度50%, 週末, 降水量0mm, 広告費10千円
predicted_sales = model.predict(new_data)
print("予測売上:", predicted_sales[0])
```

---

### **5. 結果の解釈**
1. **回帰係数**：各説明変数が目的変数に与える影響の大きさを示します。
   - 気温の係数が高ければ、気温の影響が大きい。
   - 広告費の係数が小さければ、広告の影響は限定的。
2. **切片**：全ての説明変数がゼロの場合の売上（この場合、物理的に意味は薄い）。
3. **予測**：新しい条件（例：気温29℃, 湿度50%, 週末）の売上を予測。

---

### **6. モデルの評価**
重回帰モデルの性能を評価するには、次の指標を用います：
- **決定係数 (\( R^2 \))**：モデルがどの程度データを説明できるか。
- **平均二乗誤差 (MSE)**：予測値と実測値の誤差の平均。

```python
from sklearn.metrics import r2_score, mean_squared_error

y_pred = model.predict(X)
r2 = r2_score(y, y_pred)
mse = mean_squared_error(y, y_pred)

print("決定係数 (R^2):", r2)
print("平均二乗誤差 (MSE):", mse)
```

---

### **7. 実務での活用例**
- **マーケティング**：広告費の投入効果を数値化し、効果的な予算配分を行う。
- **需要予測**：季節や天候に応じた売上の予測に利用。
- **戦略提案**：特定条件（例：湿度が高い平日）でのキャンペーン実施。

---

重回帰分析を通じて、アイスクリーム売上に影響を与える要因を詳細に理解し、具体的な改善策を提案できます！